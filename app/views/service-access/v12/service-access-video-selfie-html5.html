{% extends '_layouts/_grids/_grid-1-hotjar.html.html' %}
{% block page_title %}Access {{ serviceName }} - Take a video selfie{% endblock %}

{% set signedin = 'true' %}
{% set params = "?service=" + service + "&serviceName=" + serviceName + "&lsId=" + lsId + "&lsAccess=" + lsAccess + "&lsStudy=" + lsStudy + "&devMode=" + devMode + "&returnUrl=" + returnUrl + "&emailAddress=" + emailAddress + "&mobileNum=" + mobileNum + "&idType=" + idType + "&formerror=" + formerror + "&hidehead=" + hidehead %}


{% block extrascripts %}
<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
<script src="/getUserMedia.js"></script>
{% endblock %}

{% block header %}


{% endblock %}

{% block content %}
<div class="first-item">

    <section class="loading-container" id="scan-id-0" style="display:block">

        <h1 id="spinner-heading" style="padding-bottom: 0; display:none;">Uploading your video</h1>

        <div class="bar_container">
            <div id="main_container">
                <div id="pbar" class="progress-spinner" data-percent="0">
                    <img src="/images/loader-spinner.svg" width="200px" height="200px" id="spinner" />
                    <div class="ppc-loading">
                        <div class="pcc-percents-wrapper">
                            <span id="spinner-status">Loading</span><span aria-hidden="true">...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>

    <section id="camera-container" style="display:none">
        <div class="camera-preview-wrapper">
            <div class="camera-preview-overlay"></div>
            <div class="camera-preview-feed">
                <video id="gum" muted autoplay></video>
            </div>
        </div>

        <div class="camera-instructions">
            <div class="camera-instructions-text">Say these numbers whilst recording your short video: </div>
            <div class="camera-instructions-numbers">{{ pinCode }}</div>
        </div>

        <div class="camera-record">
            <button id="record" class="button" disabled>Start recording</button>
        </div>

        <p><a class="" href="service-access-video-selfie-instructions{{ params }}">Cancel</a></p>

        <audio id="audio" volume="0.1" src="/images/beep-3.wav" autostart="false" ></audio>
    </section>

    <section class="uploader-container" id="scan-id-3" style="display:none">

        <h1 id="progressbar-heading" style="padding-bottom: 0;">Preparing a preview...</h1>

        <div class="bar_container">
            <div id="main_container">
                <div id="pbar" class="progress-pie-chart" data-percent="0">
                    <div class="ppc-progress">
                        <div class="ppc-progress-fill"></div>
                    </div>
                    <div class="ppc-percents">
                        <div class="pcc-percents-wrapper">
                            <span>%</span>
                        </div>
                    </div>
                </div>

                <progress style="display: none" id="progress_bar" value="0" max="100"></progress>
            </div>
        </div>

    </section>


    <section class="preview-container" id="scan-id-5" style="display:none">

        <h1 style="padding-bottom: 0;">Review the short video</h1>

        <div class="reading-width">
            <div id="scan-video-preview">
                <video id="recorded" controls="" autoplay loop style="width:100%;height:auto;"></video>
            </div>
            <div class="camera-instructions">
                <div class="camera-instructions-text">Is the video clear and can you hear these 4 numbers? </div>
                <div class="camera-instructions-numbers">{{ pinCode }}</div>
            </div>
        </div>

        <button class="button" id="submitvideo">Yes, submit this video</button>



        <p><a href="#" id="retakevideo">Retake</a> or <a class="" href="service-access-video-selfie-instructions{{ params }}">Cancel</a></p>

    </section>

    <button id="download" disabled style="visibility:hidden;">Download</button>
    <button id="play" disabled style="visibility:hidden;">Play</button>
    <button id="confirmButton" style="visibility:hidden" onclick="window.location='service-access-confirmation{{ params }}';" >Continue</button>

</div>

<script type="text/javascript">
    //show then hide the spinner animation
    setTimeout(function(){
        document.getElementById('scan-id-0').style.display = 'none'
    }, 2500)
    setTimeout(function(){
        document.getElementById('camera-container').style.display = 'block'
    }, 2500)
</script>

{% endblock %}